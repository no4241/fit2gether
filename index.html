<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fit 2gether - Co-op Fitness RPG</title>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; margin: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }
        .animate-bounce-slow { animation: bounce 3s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { 
            Swords, Shield, Flame, Zap, Scroll, Plus, Trophy, Heart, 
            ChevronRight, X, History, Activity, User, HelpCircle,
            PlusCircle, Trash2, BarChart3, MessageCircle, Camera,
            Map, Star, Sparkles, Send, Image: ImageIcon, Info,
            Database, Search, Eye, Trophy: TrophyIcon, Download,
            Share, Smartphone, ShieldCheck
        } = lucideReact;

        // --- FIREBASE CONFIG ---
        // Note: When uploading to GitHub, ensure you have initialized your Firebase project.
        // The environment provides these automatically here.
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'fit-2gether-app';

        // --- CONSTANTS ---
        const GOAL_TURNS = 3;
        const SIDE_QUEST_TO_TURN = 2;
        const PLAYERS = ["Max", "Ashley"];
        const SIDE_QUEST_OPTIONS = [
            "Stretching (15m)", "5,000 Steps", "Core Work (10m)", 
            "Foam Rolling", "Short Walk (15m)", "Mobility Flow", "Other"
        ];

        const getLevel = (exp) => Math.floor((exp || 0) / 1000) + 1;

        // --- SUB-COMPONENTS ---

        const CelebrationModal = ({ type, data, onClose }) => {
            if (!type) return null;
            const content = {
                levelUp: { title: "Level Up!", subtitle: `${data?.player} reached Rank ${data?.level}!`, icon: <Star className="w-16 h-16 text-amber-400 fill-amber-400 animate-pulse" />, bg: "from-amber-500 to-orange-600" },
                goalReached: { title: "Objective Clear!", subtitle: `${data?.player} reached the weekly 3-turn target!`, icon: <TrophyIcon className="w-16 h-16 text-white animate-bounce" />, bg: "from-emerald-500 to-teal-600" },
                guildClear: { title: "Guild Clear!", subtitle: "Both Heroes have reached 3/3 turns! Weekly challenge complete.", icon: <Sparkles className="w-16 h-16 text-yellow-300 animate-spin-slow" />, bg: "from-rose-600 to-indigo-700" }
            };
            const active = content[type];
            return (
                <div className="fixed inset-0 z-[200] flex items-center justify-center p-6 bg-slate-950/90 backdrop-blur-md animate-in fade-in">
                    <div className={`bg-gradient-to-br ${active.bg} p-1 rounded-[3rem] shadow-2xl w-full max-w-xs`}>
                        <div className="bg-slate-900 rounded-[2.8rem] p-8 text-center space-y-6">
                            <div className="flex justify-center">{active.icon}</div>
                            <div className="space-y-2">
                                <h2 className="text-3xl font-black italic uppercase text-white">{active.title}</h2>
                                <p className="text-sm font-bold text-slate-400 uppercase tracking-widest">{active.subtitle}</p>
                            </div>
                            <button onClick={onClose} className="w-full bg-white text-slate-900 py-4 rounded-2xl font-black uppercase italic tracking-widest active:scale-95 transition-transform">Continue Journey</button>
                        </div>
                    </div>
                </div>
            );
        };

        const QuestDetailModal = ({ quest, onClose }) => {
            if (!quest) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-xl animate-in fade-in">
                    <div className="bg-slate-900 border border-white/10 rounded-[2.5rem] w-full max-w-sm overflow-hidden shadow-2xl">
                        <div className="p-6 bg-slate-800/50 border-b border-white/5 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center font-black text-sm shadow-lg ${quest.player === 'Max' ? 'bg-sky-500' : 'bg-rose-500'}`}>{quest.player[0]}</div>
                                <div><h3 className="font-black italic uppercase text-white leading-none">Battle Analysis</h3><p className="text-[9px] font-bold text-slate-400 uppercase mt-1">{quest.dateString}</p></div>
                            </div>
                            <button onClick={onClose} className="p-2 bg-slate-700 rounded-full text-slate-300"><X className="w-5 h-5" /></button>
                        </div>
                        <div className="p-6 space-y-6 max-h-[60vh] overflow-y-auto custom-scrollbar">
                            <div className="flex justify-around bg-slate-950 p-5 rounded-3xl border border-white/5 shadow-inner">
                                <div className="text-center"><p className="text-[9px] font-black text-slate-500 uppercase">Turns</p><p className="text-xl font-black text-white italic">{quest.turns}</p></div>
                                <div className="w-px bg-white/5" /><div className="text-center"><p className="text-[9px] font-black text-slate-500 uppercase">Sides</p><p className="text-xl font-black text-white italic">{quest.sideQuestCount || 0}</p></div>
                                <div className="w-px bg-white/5" /><div className="text-center"><p className="text-[9px] font-black text-slate-500 uppercase">EXP</p><p className="text-xl font-black text-amber-400 italic">+{quest.expGained}</p></div>
                            </div>
                            <div className="space-y-4">
                                {quest.cardio?.filter(c => c.time > 0).map((c, i) => (
                                    <div key={i} className="flex justify-between bg-slate-950/80 p-4 rounded-2xl border border-white/5"><span className="text-sm font-bold text-slate-200">{c.type || 'Cardio'}</span><span className="text-sm font-black text-rose-400 italic">{c.time}m</span></div>
                                ))}
                                {quest.strength?.filter(s => s.time > 0).map((s, i) => (
                                    <div key={i} className="bg-slate-950/80 p-5 rounded-2xl border border-white/5 space-y-2">
                                        <div className="flex justify-between border-b border-white/5 pb-2"><span className="text-sm font-bold text-slate-200">{s.type || 'Strength'}</span><span className="text-sm font-black text-sky-400 italic">{s.time}m</span></div>
                                        <p className="text-[11px] text-slate-400 italic font-medium leading-relaxed whitespace-pre-wrap">{s.exercises || "No details provided."}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="p-4 bg-slate-900"><button onClick={onClose} className="w-full bg-slate-800 text-white py-4 rounded-2xl font-black italic uppercase shadow-xl">Close Analysis</button></div>
                    </div>
                </div>
            );
        };

        const ActivityComparison = ({ player, history }) => {
            const days = ['S','M','T','W','T','F','S'];
            const now = new Date();
            const last7Days = Array.from({length: 7}).map((_, i) => {
                const d = new Date(); d.setDate(now.getDate() - (6 - i));
                return d.toLocaleDateString();
            });
            const volumes = last7Days.map(dateStr => {
                const dayQuests = history.filter(q => q.player === player && q.dateString === dateStr);
                return dayQuests.reduce((acc, curr) => acc + (curr.turns || 0) + ((curr.sideQuestCount || 0) / 2), 0);
            });
            const maxVol = Math.max(...volumes, 1);
            return (
                <div className="flex-1 p-4 bg-slate-900/40 rounded-3xl border border-white/5">
                    <p className={`text-[10px] font-black uppercase text-center mb-3 ${player === 'Max' ? 'text-sky-400' : 'text-rose-400'}`}>{player}</p>
                    <div className="flex items-end justify-between h-16 gap-1.5">
                        {volumes.map((v, i) => <div key={i} className={`flex-1 rounded-full ${player === 'Max' ? 'bg-sky-500' : 'bg-rose-500'}`} style={{ height: `${(v/maxVol)*100}%`, opacity: 0.2 + (v/maxVol)*0.8 }}></div>)}
                    </div>
                    <div className="flex justify-between mt-2">{last7Days.map((_, i) => <span key={i} className="text-[7px] text-slate-600 font-bold">{days[new Date(last7Days[i]).getDay()]}</span>)}</div>
                </div>
            );
        };

        const HelpModal = ({ type, onClose }) => {
            if (!type) return null;
            const content = {
                sidequest: { title: "Side Quest Mastery", body: "2 Side Quests = 1 Full Turn. Perfect for recovery days or quick stretches." },
                cardio: { title: "Cardio Questing", body: "30 mins = 1 Turn. Add multiple sessions using the '+' button." },
                strength: { title: "Strength Building", body: "30 mins = 1 Turn. Be specific to build your training history!" },
                turns: { title: "Weekly Target", body: "Both heroes must complete 3 Full Turns per week to clear the guild challenge!" },
                install: { title: "Spirit Link Guide", body: "To add Fit 2gether to your home screen:\n\n1. Open in Safari (iOS) or Chrome (Android).\n2. Tap the Share button (iOS) or Menu (Android).\n3. Select 'Add to Home Screen'." }
            };
            return (
                <div className="fixed inset-0 z-[100] bg-slate-950/80 backdrop-blur-md flex items-center justify-center p-6 animate-in zoom-in-95">
                    <div className="bg-white rounded-[2.5rem] p-8 max-w-xs shadow-2xl border-4 border-slate-900 text-slate-900">
                        <h4 className="text-xl font-black italic uppercase mb-3 flex items-center gap-2"><Info className="w-5 h-5 text-rose-500" /> {content[type].title}</h4>
                        <p className="text-sm font-medium leading-relaxed mb-6 whitespace-pre-wrap">{content[type].body}</p>
                        <button onClick={onClose} className="w-full bg-slate-900 text-white py-4 rounded-2xl font-black uppercase italic shadow-xl">Understood</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [history, setHistory] = useState([]);
            const [helpModalType, setHelpModalType] = useState(null); 
            const [viewingQuest, setViewingQuest] = useState(null);
            const [celebration, setCelebration] = useState({ type: null, data: null });
            const [cheerMessage, setCheerMessage] = useState("");
            const [cheerSender, setCheerSender] = useState("Max");
            const [selectedQuestId, setSelectedQuestId] = useState(null);
            const [playerData, setPlayerData] = useState({
                Max: { exp: 0, height: 180, age: 28, weight: 80, heartPoints: 0 },
                Ashley: { exp: 0, height: 165, age: 25, weight: 65, heartPoints: 0 }
            });
            const [logForm, setLogForm] = useState({ player: "Max", cardio: [{ type: "", time: 0 }], strength: [{ type: "", time: 0, exercises: "" }], sideQuestList: [{ type: "" }], photoUrl: "", battleCry: "" });

            useEffect(() => {
                const initAuth = async () => {
                  if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await auth.signInWithCustomToken(__initial_auth_token);
                  } else {
                    await auth.signInAnonymously();
                  }
                };
                initAuth();
                return auth.onAuthStateChanged(setUser);
            }, []);

            useEffect(() => {
                if (!user) return;
                const unsubQuests = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('quests')
                    .onSnapshot(snap => setHistory(snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => b.timestamp - a.timestamp)));
                const unsubStats = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('stats')
                    .onSnapshot(snap => {
                        const stats = {}; snap.forEach(d => { stats[d.id] = d.data(); });
                        if (Object.keys(stats).length > 0) setPlayerData(prev => ({...prev, ...stats}));
                    });
                return () => { unsubQuests(); unsubStats(); };
            }, [user]);

            const updateProfileStat = async (player, field, value) => {
                const val = parseInt(value) || 0;
                setPlayerData(prev => ({ ...prev, [player]: { ...prev[player], [field]: val } }));
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('stats').doc(player).set({ [field]: val }, { merge: true });
            };

            const handleSaveQuest = async () => {
                if (!user) return;
                const activePlayer = logForm.player;
                const cardio = logForm.cardio.reduce((a,c) => a + (parseInt(c.time) || 0), 0);
                const strength = logForm.strength.reduce((a,c) => a + (parseInt(c.time) || 0), 0);
                let turnsGained = Math.floor(cardio / 30) + Math.floor(strength / 30);
                const validSides = logForm.sideQuestList.filter(s => s.type !== "").length;
                let sides = validSides + (cardio > 0 && cardio % 30 !== 0 ? 1 : 0);
                const expGained = (turnsGained * 100) + (sides * 40);

                const oldExp = playerData[activePlayer]?.exp || 0;
                const oldTurns = getWeeklyProgress(activePlayer);
                const newQuest = { ...logForm, turns: turnsGained, sideQuestCount: sides, expGained, timestamp: Date.now(), dateString: new Date().toLocaleDateString() };

                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('quests').add(newQuest);
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('stats').doc(activePlayer).set({ exp: oldExp + expGained }, { merge: true });
                    
                    if (getLevel(oldExp + expGained) > getLevel(oldExp)) setCelebration({ type: 'levelUp', data: { player: activePlayer, level: getLevel(oldExp + expGained) } });
                    else if (oldTurns < 3 && (oldTurns + turnsGained + Math.floor(sides/2)) >= 3) {
                        const partner = PLAYERS.find(p => p !== activePlayer);
                        if (getWeeklyProgress(partner) >= 3) setCelebration({ type: 'guildClear', data: {} });
                        else setCelebration({ type: 'goalReached', data: { player: activePlayer } });
                    }
                    setActiveTab('dashboard');
                } catch(e) { console.error(e); }
            };

            const sendCheer = async (id) => {
                if (!cheerMessage.trim()) return;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('quests').doc(id).update({ comments: firebase.firestore.FieldValue.arrayUnion({ from: cheerSender, text: cheerMessage, timestamp: Date.now() }) });
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('stats').doc(cheerSender).set({ heartPoints: (playerData[cheerSender]?.heartPoints || 0) + 10 }, { merge: true });
                setCheerMessage(""); setSelectedQuestId(null);
            };

            const getWeeklyProgress = (p) => {
                const weekAgo = Date.now() - 604800000;
                const weekly = history.filter(q => q.player === p && q.timestamp > weekAgo);
                const turns = weekly.reduce((a,c) => a + (c.turns || 0), 0);
                const sides = weekly.reduce((a,c) => a + (c.sideQuestCount || 0), 0);
                return Math.min(3, turns + Math.floor(sides / 2));
            };

            return (
                <div className="min-h-screen pb-24 text-slate-100 selection:bg-rose-500/30 overflow-x-hidden">
                    <HelpModal type={helpModalType} onClose={() => setHelpModalType(null)} />
                    <QuestDetailModal quest={viewingQuest} onClose={() => setViewingQuest(null)} />
                    <CelebrationModal type={celebration.type} data={celebration.data} onClose={() => setCelebration({ type: null, data: null })} />

                    <header className="p-4 bg-slate-900/80 backdrop-blur-md sticky top-0 z-30 flex justify-between items-center border-b border-white/5">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-rose-500 to-orange-500 p-2 rounded-xl shadow-lg"><Flame className="text-white w-5 h-5 fill-white" /></div>
                            <div><h1 className="font-black italic uppercase tracking-tighter text-white text-xl">Fit 2gether</h1><div className="flex items-center gap-1"><Sparkles className="w-3 h-3 text-amber-400 fill-amber-400" /><span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Season 1</span></div></div>
                        </div>
                        <div className="bg-slate-800/50 px-3 py-1.5 rounded-full border border-white/5 flex items-center gap-2 shadow-lg"><Heart className="w-3 h-3 text-rose-500 fill-rose-500" /><span className="text-xs font-black">{Object.values(playerData).reduce((a,b) => a + (b.heartPoints || 0), 0)}</span></div>
                    </header>

                    <main className="max-w-md mx-auto p-4 space-y-6">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-in slide-in-from-left-4">
                                <div className="grid grid-cols-2 gap-3">
                                    {PLAYERS.map(name => (
                                        <div key={name} className="bg-slate-900 border border-white/5 p-4 rounded-[2rem] relative overflow-hidden shadow-xl">
                                            <div className={`absolute inset-0 opacity-10 bg-gradient-to-br ${name === 'Max' ? 'from-sky-500' : 'from-rose-500'} to-transparent`} />
                                            <div className="relative z-10 space-y-3">
                                                <div className="flex justify-between items-center"><span className="text-[9px] font-black uppercase px-2 py-0.5 rounded-full border border-white/10">Rank {getLevel(playerData[name]?.exp)}</span>{name === 'Max' ? <Shield className="w-4 h-4 text-sky-500" /> : <Swords className="w-4 h-4 text-rose-500" />}</div>
                                                <h2 className="text-lg font-black italic uppercase truncate">{name}</h2>
                                                <div className="space-y-1">
                                                    <div className="flex justify-between text-[10px] font-bold uppercase text-slate-500"><span>Turns</span><span>{getWeeklyProgress(name)}/{GOAL_TURNS}</span></div>
                                                    <div className="h-2 bg-white/5 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${name === 'Max' ? 'bg-sky-500' : 'bg-rose-500'}`} style={{ width: `${(getWeeklyProgress(name)/3)*100}%` }} /></div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="space-y-5">
                                    <h3 className="text-[10px] font-black italic uppercase tracking-widest text-slate-500 flex items-center gap-2 px-2"><Map className="w-4 h-4" /> Adventure Stream</h3>
                                    {history.map(quest => (
                                        <div key={quest.id} className="bg-slate-900 border border-white/5 rounded-[2.5rem] overflow-hidden shadow-2xl relative">
                                            <div className="p-5 flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-black text-xs ${quest.player === 'Max' ? 'bg-sky-600' : 'bg-rose-600'}`}>{quest.player[0]}</div>
                                                    <div><p className="font-black italic uppercase text-white tracking-tight">{quest.player}</p><p className="text-[9px] text-slate-500 font-bold uppercase tracking-widest">{quest.dateString}</p></div>
                                                </div>
                                                <div className="bg-amber-500/10 px-3 py-1.5 rounded-full border border-amber-500/20 text-amber-400 text-[10px] font-black italic">+{quest.expGained} EXP</div>
                                            </div>
                                            <div className="aspect-[4/3] bg-slate-950 relative overflow-hidden cursor-pointer" onClick={() => setViewingQuest(quest)}>
                                                {quest.photoUrl ? <img src={quest.photoUrl} alt="Workout" className="w-full h-full object-cover" /> : <div className="w-full h-full flex flex-col items-center justify-center text-slate-800 space-y-2"><Camera className="w-12 h-12 opacity-10" /><p className="text-[9px] font-black uppercase opacity-20">Verified Session</p></div>}
                                                <div className="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 to-transparent p-6"><p className="text-sm italic font-medium text-white pr-4">"{quest.battleCry || "No words needed."}"</p></div>
                                                <div className="absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-xl text-[9px] font-black uppercase text-white border border-white/10">Tap to Inspect</div>
                                            </div>
                                            <div className="p-5 space-y-4">
                                                <div className="space-y-2">{quest.comments?.map((c, i) => (<div key={i} className="bg-white/5 p-4 rounded-3xl border border-white/5"><p className="text-[10px] font-black uppercase text-amber-400 mb-1">{c.from} Cheers:</p><p className="text-xs italic text-slate-300">"{c.text}"</p></div>))}</div>
                                                <button onClick={() => setSelectedQuestId(quest.id === selectedQuestId ? null : quest.id)} className="w-full bg-rose-500/10 border border-rose-500/20 p-4 rounded-2xl flex items-center justify-center gap-2 text-[10px] font-black uppercase text-rose-400"><MessageCircle className="w-4 h-4" /> Send Cheer</button>
                                                {selectedQuestId === quest.id && (
                                                    <div className="mt-4 p-4 bg-slate-950/50 rounded-3xl border border-white/5 space-y-4">
                                                        <div className="flex bg-slate-900 p-1.5 rounded-2xl border border-white/5">{PLAYERS.map(p => (<button key={p} onClick={() => setCheerSender(p)} className={`flex-1 py-2 rounded-xl text-[9px] font-bold uppercase transition-all ${cheerSender === p ? 'bg-white text-slate-900 shadow-lg' : 'text-slate-500'}`}>{p}</button>))}</div>
                                                        <div className="flex gap-2"><input value={cheerMessage} onChange={(e) => setCheerMessage(e.target.value)} placeholder="Type a compliment..." className="flex-1 bg-slate-950 border border-white/10 p-4 rounded-2xl text-sm outline-none focus:border-rose-500 text-white" /><button onClick={() => sendCheer(quest.id)} className="bg-rose-500 p-4 rounded-2xl shadow-xl"><Send className="w-5 h-5 text-white" /></button></div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'log' && (
                            <div className="bg-slate-900 rounded-[2.5rem] p-8 border border-white/5 shadow-2xl space-y-8 animate-in slide-in-from-bottom-5">
                                <div className="flex justify-between items-center"><div><h2 className="text-2xl font-black italic uppercase text-white tracking-tighter leading-none">New Quest</h2><p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-2">Log records</p></div><button onClick={() => setActiveTab('dashboard')} className="p-2 bg-slate-800 rounded-full text-slate-400"><X className="w-5 h-5" /></button></div>
                                <div className="flex bg-slate-800/50 p-2 rounded-[1.8rem] border border-white/5">{PLAYERS.map(n => (<button key={n} onClick={() => setLogForm(f => ({...f, player: n}))} className={`flex-1 py-4 rounded-2xl font-black uppercase italic tracking-widest text-xs transition-all ${logForm.player === n ? 'bg-slate-900 text-white shadow-2xl' : 'text-slate-500'}`}>{n}</button>))}</div>
                                <div className="space-y-6">
                                    <div className="space-y-3"><label className="text-[10px] font-black uppercase text-amber-500 flex items-center gap-2"><Camera className="w-3 h-3" /> Ïù∏Ï¶ùÏÉ∑ (Proof)</label>
                                    <label className="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed rounded-[2.5rem] cursor-pointer bg-slate-950 border-white/10 relative overflow-hidden">{logForm.photoUrl ? <img src={logForm.photoUrl} className="w-full h-full object-cover" /> : <div className="text-center"><ImageIcon className="w-10 h-10 text-slate-700 mb-3 mx-auto" /><p className="text-[10px] text-slate-500 font-black uppercase">Select Photo</p></div>}<input type="file" accept="image/*" className="hidden" onChange={(e) => { const f=e.target.files[0]; const r=new FileReader(); r.onloadend=()=>setLogForm({...logForm, photoUrl: r.result}); r.readAsDataURL(f); }} /></label></div>
                                    <div className="space-y-3"><label className="text-[10px] font-black uppercase text-indigo-400 flex items-center gap-2"><Scroll className="w-3 h-3" /> Battle Cry</label><input placeholder="Feeling unstoppable! üí™" className="w-full bg-slate-950 border border-white/10 p-4 rounded-2xl text-sm outline-none text-white shadow-inner" value={logForm.battleCry} onChange={e => setLogForm({...logForm, battleCry: e.target.value})} /></div>
                                    <div className="space-y-6">
                                        <div className="space-y-4"><div className="flex justify-between items-center px-1"><label className="text-[10px] font-black uppercase text-rose-500 flex items-center gap-2"><Activity className="w-3 h-3" /> Cardio</label><button onClick={() => setLogForm({...logForm, cardio: [...logForm.cardio, {type:"", time:0}]})} className="bg-rose-500 p-1 rounded-lg text-white"><PlusCircle className="w-5 h-5" /></button></div>
                                        {logForm.cardio.map((c, i) => (<div key={i} className="flex gap-3 items-center"><input placeholder="Running" className="flex-1 bg-slate-950 border border-white/10 p-4 rounded-2xl text-sm text-white" value={c.type} onChange={e=>{const nl=[...logForm.cardio]; nl[i].type=e.target.value; setLogForm({...logForm, cardio: nl})}} /><input type="number" placeholder="Mins" className="w-20 bg-slate-950 border border-white/10 p-4 rounded-2xl text-sm text-center" value={c.time||""} onChange={e=>{const nl=[...logForm.cardio]; nl[i].time=e.target.value; setLogForm({...logForm, cardio: nl})}} /></div>))}</div>
                                        <div className="space-y-4"><div className="flex justify-between items-center px-1 pt-2"><label className="text-[10px] font-black uppercase text-blue-500 flex items-center gap-2"><Swords className="w-3 h-3" /> Strength</label><button onClick={() => setLogForm({...logForm, strength: [...logForm.strength, {type:"", time:0, exercises:""}]})} className="bg-blue-500 p-1 rounded-lg text-white"><PlusCircle className="w-5 h-5" /></button></div>
                                        {logForm.strength.map((s, i) => (<div key={i} className="bg-slate-950 border border-white/10 p-6 rounded-[2.5rem] space-y-4 shadow-inner relative">
                                            <div className="flex gap-4"><input placeholder="Legs" className="flex-1 bg-slate-900/50 p-4 rounded-2xl text-xs text-white font-bold" value={s.type} onChange={e=>{const nl=[...logForm.strength]; nl[i].type=e.target.value; setLogForm({...logForm, strength: nl})}} /><input type="number" placeholder="Mins" className="w-20 bg-slate-900/50 p-4 rounded-2xl text-xs text-center" value={s.time||""} onChange={e=>{const nl=[...logForm.strength]; nl[i].time=e.target.value; setLogForm({...logForm, strength: nl})}} /></div>
                                            <textarea placeholder="e.g. Bench 3x10..." className="w-full bg-slate-900/50 p-4 rounded-2xl text-[11px] h-24 outline-none text-slate-300" value={s.exercises} onChange={e=>{const nl=[...logForm.strength]; nl[i].exercises=e.target.value; setLogForm({...logForm, strength: nl})}} />
                                        </div>))}</div>
                                    </div>
                                    <button onClick={handleSaveQuest} className="w-full bg-gradient-to-r from-rose-600 to-orange-600 text-white py-6 rounded-[2.5rem] font-black italic uppercase tracking-widest shadow-2xl active:scale-[0.97] transition-all">Seal Record</button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'hall' && (
                            <div className="space-y-6 animate-in slide-in-from-right-4">
                                <h2 className="text-2xl font-black italic uppercase text-white tracking-tight px-2">Hall of Heroes</h2>
                                <div className="bg-slate-900 rounded-[2.5rem] p-8 border border-white/5 space-y-8 shadow-2xl">
                                    <div className="grid grid-cols-2 gap-4">
                                        {PLAYERS.map(n => (<div key={n} className="bg-slate-950/50 p-6 rounded-[2rem] border border-white/5 text-center shadow-inner"><p className="text-[10px] font-black uppercase text-slate-500 mb-1">{n}</p><p className="text-3xl font-black italic text-white leading-none">{playerData[n]?.exp || 0}</p><p className="text-[8px] font-bold text-amber-500/60 uppercase mt-2 tracking-widest">Total EXP</p></div>))}
                                    </div>
                                    <div className="pt-8 border-t border-white/5 space-y-8">
                                        <h4 className="text-[10px] font-black uppercase text-slate-500 flex items-center gap-1.5 italic"><BarChart3 className="w-3 h-3" /> Training Volume</h4>
                                        <div className="flex gap-4"><ActivityComparison player="Max" history={history} /><ActivityComparison player="Ashley" history={history} /></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'profile' && (
                            <div className="space-y-4 animate-in slide-in-from-right-4">
                                <h2 className="text-2xl font-black italic uppercase text-white tracking-tight px-2">Hero Hub</h2>
                                <div className="bg-slate-900 rounded-[2.5rem] p-6 border border-white/5 space-y-4 shadow-2xl">
                                    {PLAYERS.map(n => (
                                        <div key={n} className="space-y-3 p-5 bg-slate-950 rounded-[2rem] border border-white/5 shadow-inner">
                                            <div className="flex items-center justify-between">
                                                <p className="font-black italic uppercase text-slate-300 tracking-widest">{n}</p>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-[10px] font-bold text-rose-500 flex items-center gap-1"><Heart className="w-3 h-3 fill-rose-500" /> {playerData[n]?.heartPoints || 0}</span>
                                                    <div className="flex gap-0.5">{[...Array(3)].map((_,i) => <Star key={i} className={`w-3.5 h-3.5 ${getLevel(playerData[n]?.exp) > i*5 ? 'text-amber-400 fill-amber-400' : 'text-slate-800'}`} />)}</div>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-3 gap-2">
                                                <div className="space-y-1"><label className="text-[7px] font-black text-slate-600 uppercase">Age</label><input type="number" value={playerData[n]?.age || ""} onChange={(e) => updateProfileStat(n, 'age', e.target.value)} className="w-full bg-slate-900 p-2.5 rounded-xl border border-white/5 text-xs font-bold text-white outline-none" /></div>
                                                <div className="space-y-1"><label className="text-[7px] font-black text-slate-600 uppercase">Height</label><input type="number" value={playerData[n]?.height || ""} onChange={(e) => updateProfileStat(n, 'height', e.target.value)} className="w-full bg-slate-900 p-2.5 rounded-xl border border-white/5 text-xs font-bold text-white outline-none" /></div>
                                                <div className="space-y-1"><label className="text-[7px] font-black text-slate-600 uppercase">Weight</label><input type="number" value={playerData[n]?.weight || ""} onChange={(e) => updateProfileStat(n, 'weight', e.target.value)} className="w-full bg-slate-900 p-2.5 rounded-xl border border-white/5 text-xs font-bold text-white outline-none" /></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-gradient-to-br from-indigo-950/40 to-slate-900 border border-indigo-500/20 p-5 rounded-[2rem] shadow-xl space-y-3">
                                    <div className="flex items-center gap-3"><div className="bg-indigo-500 p-1.5 rounded-lg"><Download className="w-4 h-4 text-white" /></div><h3 className="text-sm font-black uppercase italic text-white tracking-tight leading-none">Spirit Link Guide</h3></div>
                                    <p className="text-[10px] text-slate-500 font-medium leading-tight">Install for a full-screen adventure shortcut.</p>
                                    <button onClick={() => setHelpModalType('install')} className="w-full bg-white text-slate-900 py-3 rounded-xl font-black uppercase italic text-[10px] flex items-center justify-center gap-2">
                                        <Smartphone className="w-4 h-4" /> Get Shortcut Guide
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-slate-950/90 backdrop-blur-3xl border-t border-white/5 p-3 flex justify-around items-center max-w-md mx-auto z-40 shadow-2xl">
                        <button onClick={() => setActiveTab('dashboard')} className={`flex flex-col items-center p-3 rounded-2xl transition-all ${activeTab === 'dashboard' ? 'text-rose-500 bg-rose-500/10' : 'text-slate-500'}`}><Map className="w-6 h-6" /><span className="text-[9px] font-black uppercase mt-1 italic tracking-widest">Map</span></button>
                        <button onClick={() => setActiveTab('hall')} className={`flex flex-col items-center p-3 rounded-2xl transition-all ${activeTab === 'hall' ? 'text-amber-500 bg-amber-500/10' : 'text-slate-500'}`}><Trophy className="w-6 h-6" /><span className="text-[9px] font-black uppercase mt-1 italic tracking-widest">Hall</span></button>
                        <button onClick={() => setActiveTab('log')} className="bg-gradient-to-tr from-rose-500 to-orange-600 text-white p-5 rounded-full -mt-12 shadow-2xl shadow-rose-900/40 active:scale-90 transition-transform ring-8 ring-[#0f172a]"><Plus className="w-7 h-7" /></button>
                        <button onClick={() => setActiveTab('profile')} className={`flex flex-col items-center p-3 rounded-2xl transition-all ${activeTab === 'profile' ? 'text-indigo-500 bg-indigo-500/10' : 'text-slate-500'}`}><User className="w-6 h-6" /><span className="text-[9px] font-black uppercase mt-1 italic tracking-widest">Hero</span></button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
